codecov:
  notify:
    # we upload coverage reports for all the components we test:
    # - nidx
    # - search
    # - nucliadb (in 3 parallel steps)
    # - nucliadb components (ingest, reader, standalone, train and writer)
    # - libraries (dataset, models, sdk, telemetry, utils)
    after_n_builds: 15

coverage:
  status:
    project:
      default:
        target: auto
        threshold: 1%

    patch: off

ignore:
  - "**/setup.py"
  - "**/tests/**"
  - "**/test_*.py"

component_management:
  default_rules:
    statuses:
      - type: project
        # some room for flaky coverage reporting
        threshold: 5%

  individual_components:

    # nucliadb library (including its components)
    - component_id: nucliadb
      name: nucliadb
      paths:
        - nucliadb/src/nucliadb/**
      statuses:
        - type: project
          target: 85%

    - component_id: sdk
      name: sdk
      paths:
        - nucliadb_sdk/src/nucliadb_sdk/**
      statuses:
        - type: project
          target: 90%

    - component_id: dataset
      name: dataset
      paths:
        - nucliadb_dataset/src/nucliadb_dataset/**
      statuses:
        - type: project
          target: 60%

    - component_id: standalone
      name: standalone
      paths:
        - nucliadb/src/nucliadb/standalone/**
      statuses:
        - type: project
          target: 85%

    - component_id: reader
      name: reader
      paths:
        - nucliadb/src/nucliadb/reader/**
      statuses:
        - type: project
          target: 90%

    - component_id: search
      name: search
      paths:
        - nucliadb/src/nucliadb/search/**
      statuses:
        - type: project
          target: 85%

    - component_id: train
      name: train
      paths:
        - nucliadb/src/nucliadb/train/**
      statuses:
        - type: project
          target: 60%

    - component_id: writer
      name: writer
      paths:
        - nucliadb/src/nucliadb/writer/**
      statuses:
        - type: project
          target: 65%

    - component_id: ingest
      name: ingest
      paths:
        - nucliadb/src/nucliadb/ingest/**
      statuses:
        - type: project
          target: 85%

    - component_id: models
      name: nucliadb_models
      paths:
        - nucliadb_models/**
      statuses:
        - type: project
          target: 95%

    - component_id: utils
      name: nucliadb_utils
      paths:
        - nucliadb_utils/**
      statuses:
        - type: project
          target: 85%

    - component_id: telemetry
      name: nucliadb_telemetry
      paths:
        - nucliadb_telemetry/**
      statuses:
        - type: project
          target: 80%

    - component_id: nidx
      name: nidx
      paths:
        - nidx/**
      statuses:
        - type: project
          target: 75%
